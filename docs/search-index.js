crystal_doc_search_index_callback({"repository_name":"github.com/ilanusse/praetorian","body":"# Praetorian\n[![Build Status](https://travis-ci.org/ilanusse/praetorian.svg?branch=master)](https://travis-ci.org/ilanusse/praetorian)\n\nA minimalist Crystal authorization system inspired by https://github.com/varvet/pundit.\n\n## Installation\n\n```crystal\ndependencies:\n  praetorian:\n    github: ilanusse/praetorian\n```\n\n## Policies\n\nPraetorian, inspired by Pundit, works with policy classes. This shard is not designed to be extra compatible with any framework but rather with flexibility in mind.\nThis is a simple example that allows updating\na post if the user is an admin, or if the post is unpublished:\n\n```crystal\nclass Post\n  include Praetorian::HasPolicy\n\n  def policy_class\n    PostPolicy\n  end\nend\n\n\nclass PostPolicy\n  include Praetorian::Policy\n\n  property user, post\n\n  def initialize(user, post)\n    @user = user\n    @post = post\n  end\n\n  def update?\n    user.admin? || !post.published?\n  end\nend\n```\n\nThere are two things to notice here:\n- The Post is a class that should obey a certain Policy. We mark this by including `Praetorian::HasPolicy` and overriding the `policy_class` abstract method to return the policy class name.\n\n- The Policy class includes `Praetorian::Policy`. This adds query methods to our policy as defaults that should be overwritten as necessary.\n\nThe supported query methods are: `index?`, `show?`, `create?`, `new?`, `update?`, `edit?`, `destroy?`.\n\nOk. So far, pretty simple.\n\nYou can set up simple base classes to inherit from:\n\n```crystal\nclass ApplicationModel < WhateverORMYouAreUsingModel\n  include Praetorian::HasPolicy # So you just need to overwrite `policy_class` in each model\nend\n\nclass ApplicationPolicy\n  include Praetorian::Policy\n\n  property user, record\n\n  def initialize(user, record)\n    @user = user\n    @record = record\n  end\nend\n```\n\nSupposing that you have an instance of class `Post`, Praetorian lets you authorize the object use in\nyour code flow:\n\n```crystal\ndef update\n  @post = Post.find(params[:id])\n  Praetorian.authorize(current_user, @post, :update?)\n  # Rest of code flow\nend\n```\n\nA `Praetorian::NotAuthorizedException` will be raised if the user is not authorized to perform said query on the record.\n\nYou can pass an argument to override the policy class if necessary. For example:\n\n```crystal\ndef create\n  @publication = find_publication # assume this method returns any model that behaves like a publication\n  # @publication.class => Post\n  Praetorian.authorize(current_user, @publication, :create?, PublicationPolicy)\n  # Rest of code flow\nend\n```\n\n# License\n\nLicensed under the MIT license, see the separate LICENSE.txt file.\n","program":{"html_id":"github.com/ilanusse/praetorian/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"github.com/ilanusse/praetorian","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/ilanusse/praetorian/Praetorian","path":"Praetorian.html","kind":"module","full_name":"Praetorian","name":"Praetorian","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"praetorian/version.cr","line_number":1,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/version.cr"},{"filename":"praetorian.cr","line_number":3,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr"},{"filename":"praetorian/has_policy.cr","line_number":1,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/has_policy.cr"},{"filename":"praetorian/policy.cr","line_number":1,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr"}],"repository_name":"github.com/ilanusse/praetorian","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"\"0.1.0\".freeze","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[{"id":"authorize(user,record:Praetorian::HasPolicy,query,policy_class=nil)-class-method","html_id":"authorize(user,record:Praetorian::HasPolicy,query,policy_class=nil)-class-method","name":"authorize","doc":"\nRetrieves the policy for the given record, initializing it with the\nrecord and user and finally throwing an error if the user is not\nauthorized to perform the given action.\n","summary":"<p>Retrieves the policy for the given record, initializing it with the record and user and finally throwing an error if the user is not authorized to perform the given action.</p>","abstract":false,"args":[{"name":"user","doc":null,"default_value":"","external_name":"user","restriction":""},{"name":"record","doc":null,"default_value":"","external_name":"record","restriction":"Praetorian::HasPolicy"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""},{"name":"policy_class","doc":null,"default_value":"nil","external_name":"policy_class","restriction":""}],"args_string":"(user, record : Praetorian::HasPolicy, query, policy_class = <span class=\"n\">nil</span>)","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr#L27","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr#L27","def":{"name":"authorize","args":[{"name":"user","doc":null,"default_value":"","external_name":"user","restriction":""},{"name":"record","doc":null,"default_value":"","external_name":"record","restriction":"Praetorian::HasPolicy"},{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""},{"name":"policy_class","doc":null,"default_value":"nil","external_name":"policy_class","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"policy = policy_class ? policy_class.new(user, record) : self.policy_from_record(user, record)\nif check_auth(policy, query)\nelse\n  raise(NotAuthorizedException.new(query, record, policy))\nend\nrecord\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/ilanusse/praetorian/Praetorian/HasPolicy","path":"Praetorian/HasPolicy.html","kind":"module","full_name":"Praetorian::HasPolicy","name":"HasPolicy","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"praetorian/has_policy.cr","line_number":5,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/has_policy.cr"}],"repository_name":"github.com/ilanusse/praetorian","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/ilanusse/praetorian/Praetorian","kind":"module","full_name":"Praetorian","name":"Praetorian"},"doc":"\nAn interface module that should be included by objects that should respond to a given policy.\n","summary":"<p>An interface module that should be included by objects that should respond to a given policy.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"policy_class-instance-method","html_id":"policy_class-instance-method","name":"policy_class","doc":"\nUser implemented. Returns the policy class to be used for the given class.\n","summary":"<p>User implemented.</p>","abstract":true,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/has_policy.cr#L9","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/has_policy.cr#L9","def":{"name":"policy_class","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":""}}],"macros":[],"types":[]},{"html_id":"github.com/ilanusse/praetorian/Praetorian/NotAuthorizedException","path":"Praetorian/NotAuthorizedException.html","kind":"class","full_name":"Praetorian::NotAuthorizedException","name":"NotAuthorizedException","abstract":false,"superclass":{"html_id":"github.com/ilanusse/praetorian/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"github.com/ilanusse/praetorian/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"github.com/ilanusse/praetorian/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/ilanusse/praetorian/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"praetorian.cr","line_number":7,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr"}],"repository_name":"github.com/ilanusse/praetorian","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/ilanusse/praetorian/Praetorian","kind":"module","full_name":"Praetorian","name":"Praetorian"},"doc":"\nException that will be raised when authorization has failed.\n","summary":"<p>Exception that will be raised when authorization has failed.</p>","class_methods":[],"constructors":[{"id":"new(query,record,policy)-class-method","html_id":"new(query,record,policy)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""},{"name":"record","doc":null,"default_value":"","external_name":"record","restriction":""},{"name":"policy","doc":null,"default_value":"","external_name":"policy","restriction":""}],"args_string":"(query, record, policy)","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr#L8","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr#L8","def":{"name":"new","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""},{"name":"record","doc":null,"default_value":"","external_name":"record","restriction":""},{"name":"policy","doc":null,"default_value":"","external_name":"policy","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(query, record, policy)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/ilanusse/praetorian/Praetorian/Policy","path":"Praetorian/Policy.html","kind":"module","full_name":"Praetorian::Policy","name":"Policy","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"praetorian/policy.cr","line_number":6,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr"}],"repository_name":"github.com/ilanusse/praetorian","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/ilanusse/praetorian/Praetorian","kind":"module","full_name":"Praetorian","name":"Praetorian"},"doc":"\nA Policy is a collection of methods that responds to authorization queries. The ones listed below\nare defaults and should be overwritten when writing Policy classes.\n","summary":"<p>A Policy is a collection of methods that responds to authorization queries.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"create?-instance-method","html_id":"create?-instance-method","name":"create?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L15","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L15","def":{"name":"create?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"false"}},{"id":"destroy?-instance-method","html_id":"destroy?-instance-method","name":"destroy?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L31","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L31","def":{"name":"destroy?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"false"}},{"id":"edit?-instance-method","html_id":"edit?-instance-method","name":"edit?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L27","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L27","def":{"name":"edit?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"update?"}},{"id":"index?-instance-method","html_id":"index?-instance-method","name":"index?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L7","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L7","def":{"name":"index?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"false"}},{"id":"new?-instance-method","html_id":"new?-instance-method","name":"new?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L19","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L19","def":{"name":"new?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"create?"}},{"id":"show?-instance-method","html_id":"show?-instance-method","name":"show?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L11","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L11","def":{"name":"show?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"false"}},{"id":"update?-instance-method","html_id":"update?-instance-method","name":"update?","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L23","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian/policy.cr#L23","def":{"name":"update?","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"false"}}],"macros":[],"types":[]},{"html_id":"github.com/ilanusse/praetorian/Praetorian/QueryNotSupportedException","path":"Praetorian/QueryNotSupportedException.html","kind":"class","full_name":"Praetorian::QueryNotSupportedException","name":"QueryNotSupportedException","abstract":false,"superclass":{"html_id":"github.com/ilanusse/praetorian/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"github.com/ilanusse/praetorian/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"github.com/ilanusse/praetorian/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/ilanusse/praetorian/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"praetorian.cr","line_number":16,"url":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr"}],"repository_name":"github.com/ilanusse/praetorian","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/ilanusse/praetorian/Praetorian","kind":"module","full_name":"Praetorian","name":"Praetorian"},"doc":"\nException that will be raised when a query that is not supported is called.\n","summary":"<p>Exception that will be raised when a query that is not supported is called.</p>","class_methods":[],"constructors":[{"id":"new(query)-class-method","html_id":"new(query)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""}],"args_string":"(query)","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr#L17","source_link":"https://github.com/ilanusse/praetorian/blob/ffad56b11a895715e6d199181fffbac79849bbed/src/praetorian.cr#L17","def":{"name":"new","args":[{"name":"query","doc":null,"default_value":"","external_name":"query","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(query)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[],"macros":[],"types":[]}]}]}})